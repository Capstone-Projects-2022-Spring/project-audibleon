{% extends 'base.html' %}
{% block title %}Translate from ASL{% endblock %}
{% block style %}
    .row {
      padding-top: 20px;
    }
{% endblock %}

{% block content%}

<div class="row">
    <div class="col align-items-start"></div>
    <div class="col align-items-center">
        {% if translating and wordsModel %}
<!--        <h2>Press 'q' to end the translation</h2>-->
        <img src="{{ url_for('views.video_feed') }}">
        {% elif translating %}
        this is the view for the alphabet translator
        {% endif %}

    </div>

    <div class="col align-items-end">
        {% if translating %}
        <h3>Translation output</h3>
        <textarea class="form-control" id="words" rows="5" disabled readonly></textarea>
        <button type="button" id="audio" class="btn btn-primary" onclick="getAudio()">Play Audio</button>
        {% endif %}
    </div>
</div>

<div class="container">
  <div class="row">
    <div class="col text-center">
        <form method="POST">
        {% if not translating %}
        <input type="submit" class="btn btn-lg btn-success" name="translateButton" value="Words">
        <input type="submit" class="btn btn-lg btn-success" name="translateButton" value="Alphabet">
        {% elif translating %}
        <input type="submit" class="btn btn-lg btn-danger" name="translateButton" value="Restart Translation">
        {% endif %}
        </form>
    </div>
  </div>
</div>

{% endblock %}


{% block script %}
<script>
   $('#launchModal').on('click', function (e) {

        $("#stopTranslate").modal('show');

    });

    var myTimer = setInterval(updateText, 3000);

    function updateText(){
        var updatedText = $.get("{{ url_for('views.get_words') }}");

        updatedText.done(function(results) {
            var result = "";
            results.results.forEach(item => {
                item = item.replaceAll("_", " ");
                result = result.concat(" ", item);
            });
            $('#words').text(result);
        });

    }

    function getAudio(){
        var updatedText = $.get("{{ url_for('views.get_words') }}");

        updatedText.done(function(results) {
            var result = "";

            results.results.forEach(item => {
                item = item.replaceAll("_", " ");
                result = result.concat(" ", item);
            });

            console.log(result)
            var msg = new SpeechSynthesisUtterance('Translated output:'+result);
            window.speechSynthesis.speak(msg);

        })
    }

    document.addEventListener('keypress', (event) => {
      var name = event.key;
      var code = event.code;
      // Alert the key name and key code on keydown
      console.log(`Key pressed ${name} \r\n Key code value: ${code}`);
      if (name === 'q') {
        clearInterval(myTimer);
      }
    }, false);

</script>
{% endblock %}